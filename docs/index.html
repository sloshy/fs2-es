<!DOCTYPE html><html><head><title>FS2-ES: Introduction</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Ryan Peters" /><meta name="description" content="A small library for event-driven state and event-sourcing for FS2" /><meta name="og:image" content="/sloshy.github.io/img/poster.png" /><meta name="image" property="og:image" content="/sloshy.github.io/img/poster.png" /><meta name="og:title" content="FS2-ES: Introduction" /><meta name="title" property="og:title" content="FS2-ES: Introduction" /><meta name="og:site_name" content="FS2-ES" /><meta name="og:url" content="https://sloshy.github.io/fs2-es/" /><meta name="og:type" content="website" /><meta name="og:description" content="A small library for event-driven state and event-sourcing for FS2" /><link rel="icon" type="image/png" href="/sloshy.github.io/img/favicon.png" /><meta name="twitter:title" content="FS2-ES: Introduction" /><meta name="twitter:image" content="/sloshy.github.io/img/poster.png" /><meta name="twitter:description" content="A small library for event-driven state and event-sourcing for FS2" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@LiquidSloshalot" /><link rel="icon" type="image/png" sizes="16x16" href="/sloshy.github.io/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/sloshy.github.io/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/sloshy.github.io/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/sloshy.github.io/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/sloshy.github.io/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/sloshy.github.io/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/sloshy.github.io/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/sloshy.github.io/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/sloshy.github.io/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/sloshy.github.io/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/sloshy.github.io/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/sloshy.github.io/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/sloshy.github.io/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/sloshy.github.io/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/sloshy.github.io/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/sloshy.github.io/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/sloshy.github.io/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/sloshy.github.io/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/sloshy.github.io/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/sloshy.github.io/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/sloshy.github.io/highlight/styles/vs.css" /><link rel="stylesheet" href="/sloshy.github.io/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/sloshy.github.io/" class="brand"><div class="brand-wrapper"></div><span>FS2-ES</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item active "><a href="/sloshy.github.io/docs/" title="Intro" class="active">Intro</a></div> <div class="sidebar-nav-item  "><a href="/sloshy.github.io/docs/eventstate" title="EventState" class="">EventState</a></div> <div class="sidebar-nav-item  "><a href="/sloshy.github.io/docs/expiringref" title="ExpiringRef" class="">ExpiringRef</a></div> <div class="sidebar-nav-item  "><a href="/sloshy.github.io/docs/eventstatecache" title="EventStateCache" class="">EventStateCache</a></div> <div class="sidebar-nav-item  "><a href="/sloshy.github.io/docs/mapref" title="MapRef" class="">MapRef</a></div> <div class="sidebar-nav-item  "><a href="/sloshy.github.io/docs/deferredmap" title="DeferredMap" class="">DeferredMap</a></div> <div class="sidebar-nav-item  "><a href="/sloshy.github.io/docs/testing" title="Testing" class="">Testing</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/sloshy/fs2-es" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/sloshy/fs2-es" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="sloshy" data-github-repo="fs2-es"><div class="content-wrapper"><section><h1 id="introduction">Introduction</h1>
<p>Modelling state with events can be simple to understand, but difficult to master.
You may have heard of “event sourcing”, or perhaps the “Flux” and “Redux” models of application architecture in JavaScript.
In each of these, there lies a common thread of having event-driven systems where the only way to modify state is by taking in a linear sequence of events as they occur.</p>

<p>One easy way to model this is using <code class="language-plaintext highlighter-rouge">fold</code> in functional languages.
For example, here is a basic way to get some event-driven state using “fold”, written using the FS2 streaming library:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="k">import</span> <span class="nn">fs2.</span><span class="o">{</span><span class="nc">Pipe</span><span class="o">,</span> <span class="nc">Pure</span><span class="o">,</span> <span class="nc">Stream</span><span class="o">}</span>

<span class="c1">//A function that takes our stream and computes a final result state</span>
<span class="k">def</span> <span class="nf">buildState</span><span class="k">:</span> <span class="kt">Pipe</span><span class="o">[</span><span class="kt">Pure</span>, <span class="kt">Int</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">s</span> <span class="k">=&gt;</span> <span class="nv">s</span><span class="o">.</span><span class="py">fold</span><span class="o">(</span><span class="mi">0</span><span class="o">)(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">incomingEvents</span> <span class="k">=</span> <span class="nc">Stream</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
</code></pre></div></div>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//Now we run our program and observe the resulting state</span>
<span class="nv">incomingEvents</span><span class="o">.</span><span class="py">through</span><span class="o">(</span><span class="n">buildState</span><span class="o">).</span><span class="py">compile</span><span class="o">.</span><span class="py">last</span>
<span class="c1">// res0: cats.package.Id[Option[Int]] = Some(value = 6)</span>
</code></pre></div></div>

<p>There are several advantages to building your state from events, especially if they hold the following properties:</p>
<ul>
  <li>Events are immutable and never change</li>
  <li>Events represent things that have happened, and not intentions to perform a specific action</li>
  <li>The order of events is strictly linear for any “aggregate root” (a single unit of state that does not depend on any parent relationship).</li>
</ul>

<p>In trying to achieve these properties, certain patterns emerge that this library hopes to properly encode.
I personally take the view that overly-opinionated frameworks around event sourcing are a bad idea as they not only constrain the entire design of your progam but they also make it harder to be more flexible with the definition of event-driven state that you happen to employ.
For example, many frameworks make an opinionated decision about where you store your event log.
This library has nothing to say about persistence, only functionality related to restoring and managing the lifetimes of state from events.
You can very easily build your own event log just by serializing events and putting them in a database table, Apache Kafka or Pulsar, or even to a raw file for example, and in my opinion that is the easiest part of this to “get right” on your own.</p>

<p>This library chooses to focus on some of the more easily composable parts of event sourcing.
To that end, it comes with a few useful utilities you should get to know.
Start with <code class="language-plaintext highlighter-rouge">EventState</code> in the sidebar and continue from there.</p>

<h2 id="what-to-use">What to use?</h2>
<p>If you are doing a small event-sourced program and maybe only have a few, finite sources of event-sourced state, you can get by with only <code class="language-plaintext highlighter-rouge">EventState</code> just fine.
If you have a number that you are quite confident should fit in memory, but might be dynamic for other reasons, make a <code class="language-plaintext highlighter-rouge">MapRef[K, EventState]</code> or use some other pattern/structure to organize your state.
If you need custom lifetime management built on top of that, feel free to write your own structures using <code class="language-plaintext highlighter-rouge">ExpiringRef</code> as well on top of that, or on the side as-needed.
Lastly, if you need all of that plus a key/value repository interface for your event-sourced state, <code class="language-plaintext highlighter-rouge">EventStateCache</code> should give you everything you need at once.
It not only handles retrieving your state from your event log as you define it, but it also makes sure that you do not waste precious time or resources re-running the same event log queries by caching state in-memory.</p>

<p>If you do not need “the full package” you should very easily be able to build what you need with each of the smaller parts that make up one <code class="language-plaintext highlighter-rouge">EventStateCache</code>.
Try it out, see what works for you, and if you were able to build something that fit your use cases better with it, be sure to let me know!</p>

<p>Happy event sourcing!</p>
</section></div></div></div></div><script src="/sloshy.github.io/highlight/highlight.pack.js"></script><script src="/sloshy.github.io/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'fs2-es/community'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/sloshy.github.io/js/search.js"></script><script src="/sloshy.github.io/js/docs.js"></script></body></html>